@page "/Register"

<MudButton OnClick="Authorize">Authorize</MudButton>
<MudButton OnClick="Submit">Submit</MudButton>


@code {


    public HttpClient apiConnection(string uri)
    {
        var APIclient = new HttpClient();
        APIclient.BaseAddress = new Uri(uri);

        return APIclient;
    }

    //PostAsync();
    private async Task Submit()
    {
        string code = GetQueryParm("code", NavigationManager);
        HttpClient client = apiConnection("https://eu.battle.net/oauth/token");
        client.DefaultRequestHeaders.Authorization = new System.Net.Http.Headers.AuthenticationHeaderValue("Basic", "1982e5a534d049c2be0c44fa9a4c3171:6J4G57M927DI3z3adm5iI3hIvn185CbG");
        client.DefaultRequestHeaders.Add("Content-Type", "multipart/form-data");
        var response = await client.PostAsync($"?grant_type=authorization_code&code={code}&redirect_uri=https%3A%2F%2Flocalhost%3A44374%2FRegister&client_id=1982e5a534d049c2be0c44fa9a4c3171", null);
    }

    private async Task Authorize()
    {
        var auth = await apiConnection("https://eu.battle.net/oauth/authorize").GetAsync("?response_type=code&client_id=1982e5a534d049c2be0c44fa9a4c3171&redirect_uri=https%3A%2F%2Flocalhost%3A44374%2FRegister&scope=wow.profile");
        NavigationManager.NavigateTo(auth.RequestMessage.RequestUri.OriginalString);

    }

    string GetQueryParm(string parmName, NavigationManager nav)
    {
        var uriBuilder = new UriBuilder(nav.Uri);
        var q = System.Web.HttpUtility.ParseQueryString(uriBuilder.Query);
        return q[parmName] ?? "";
    }
}
