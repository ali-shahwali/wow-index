@page "/"
@using WowIndex.Models.RaidingLeaderboards
@using Microsoft.Extensions.Configuration
@inject WowIndex.Data.ApplicationDbContext _context

<MudTable ServerData="@(new Func<TableState, Task<TableData<LeaderboardCastleNathria>>>(ServerReload))" RowsPerPage="100" Dense="true" Height="calc(100vh - 236px)" FixedHeader="true" @ref="table" Hover="true">
    <HeaderContent>
        <MudTh></MudTh>
        <MudTh>Guild</MudTh>
        <MudTh>Realm</MudTh>
        <MudTh></MudTh>
        <MudTh>Progress</MudTh>
    </HeaderContent>
    <RowTemplate>
        @{
            var guild = Guilds.Where(x => x.GuildId == context.GuildId).FirstOrDefault();
        }
        <MudTd DataLabel="Rank">
            <b style="color: #0070DD"></b>
        </MudTd>
        <MudTd DataLabel="Guild">
            <MudButton Disabled="true" Color="Color.Info">
                @guild.Name
            </MudButton>
        </MudTd>
        <MudTd DataLabel="Guild">
            <MudButton Disabled="true" Color="Color.Info">
                @guild.Realm
            </MudButton>
        </MudTd>
        <MudTd DataLabel="Guild">
            <MudButton Disabled="true" Color="Color.Info">
                @context.Progress
            </MudButton>
        </MudTd>
    </RowTemplate>
    <PagerContent>
        <MudTablePager DisableRowsPerPage="true" />
    </PagerContent>
</MudTable>

@code {
    public MudTable<LeaderboardCastleNathria> table;

    public List<Models.Guild> Guilds = new List<Models.Guild>();

    private async Task<TableData<LeaderboardCastleNathria>> ServerReload(TableState state)
    {
        // bind records from database
        var leaderboard = await _context.LeaderboardCastleNathria.ToListAsync();

        foreach (var item in leaderboard)
        {
            var guild = _context.Guilds.Where(x => x.Id == item.GuildId).FirstOrDefault();
            Guilds.Add(guild);
        }

        StateHasChanged();
        return new TableData<LeaderboardCastleNathria>() { Items = leaderboard };
    }
}
